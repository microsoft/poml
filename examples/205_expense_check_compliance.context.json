{
  "trip_context": {
    "is_international": false,
    "trip_length_days": 4
  },
  "extracted_documents": [
    {
      "source": "assets/203_flight_itinerary.pdf",
      "doc_type": "flight_itinerary",
      "merchant": "Sample Air",
      "currency": "USD",
      "lines": [
        {
          "date": "2025-10-01",
          "description": "Flight XY123 Sample Air New York (JFK) to London (LHR)",
          "category": "airfare",
          "amount": 0
        },
        {
          "date": "2025-10-10",
          "description": "Flight XY124 Sample Air London (LHR) to New York (JFK)",
          "category": "airfare",
          "amount": 0
        }
      ],
      "subtotals_by_category": [
        {
          "category": "airfare",
          "amount": 0
        }
      ]
    },
    {
      "source": "assets/203_hotel_invoice.pdf",
      "doc_type": "hotel_invoice",
      "merchant": "Hotel Paradise",
      "currency": "USD",
      "lines": [
        {
          "date": null,
          "description": "Deluxe Room 4 nights @ $150",
          "category": "lodging",
          "amount": 600
        },
        {
          "date": null,
          "description": "Breakfast 4 @ $20",
          "category": "meals",
          "amount": 80
        },
        {
          "date": null,
          "description": "Airport Pickup",
          "category": "ground_transportation",
          "amount": 50
        }
      ],
      "subtotals_by_category": [
        {
          "category": "lodging",
          "amount": 600
        },
        {
          "category": "meals",
          "amount": 80
        },
        {
          "category": "ground_transportation",
          "amount": 50
        }
      ]
    },
    {
      "source": "assets/203_meal_receipt.png",
      "doc_type": "receipt",
      "merchant": null,
      "currency": "USD",
      "lines": [
        {
          "date": "2024-04-16",
          "description": "CHEESEBURGER",
          "category": "meals",
          "amount": 10.99
        },
        {
          "date": "2024-04-16",
          "description": "FRIED CHICKEN",
          "category": "meals",
          "amount": 13.5
        },
        {
          "date": "2024-04-16",
          "description": "FRENCH FRIES",
          "category": "meals",
          "amount": 4.5
        },
        {
          "date": "2024-04-16",
          "description": "ICE CREAM",
          "category": "meals",
          "amount": 2.5
        }
      ],
      "subtotals_by_category": [
        {
          "category": "meals",
          "amount": 31.49
        }
      ]
    },
    {
      "source": "assets/203_taxi_receipt.png",
      "doc_type": "receipt",
      "merchant": "Taxi Receipt",
      "currency": "USD",
      "lines": [
        {
          "date": "2024-04-05",
          "description": "Miles",
          "category": "miles",
          "amount": 8.4
        },
        {
          "date": "2024-04-05",
          "description": "Fare",
          "category": "ground_transportation",
          "amount": 23.5
        },
        {
          "date": "2024-04-05",
          "description": "Tax",
          "category": "tax",
          "amount": 1
        },
        {
          "date": "2024-04-05",
          "description": "Total",
          "category": "total",
          "amount": 24.5
        }
      ],
      "subtotals_by_category": [
        {
          "category": "miles",
          "amount": 8.4
        },
        {
          "category": "ground_transportation",
          "amount": 23.5
        },
        {
          "category": "tax",
          "amount": 1
        }
      ]
    }
  ],
  "relevant_rules": {
    "trip_context": {
      "is_international": false,
      "trip_length_days": 4
    },
    "rules": [
      {
        "rule_id": 1,
        "category": "lodging",
        "type": "per_night_cap",
        "scope": "domestic",
        "reference": "Policy 4. Accommodation: Use standard mid-range; cap 200 USD/night",
        "value": 200,
        "unit": "USD/night",
        "requires_preapproval": true,
        "non_reimbursable": false
      },
      {
        "rule_id": 2,
        "category": "meals",
        "type": "per_day_cap",
        "scope": "domestic",
        "reference": "Budget Table Appendix: Meals per diem domestic 60 USD/day",
        "value": 60,
        "unit": "USD/day",
        "requires_preapproval": false,
        "non_reimbursable": false
      },
      {
        "rule_id": 3,
        "category": "ground_transportation",
        "type": "per_day_cap",
        "scope": "domestic",
        "reference": "Budget Table: Ground Transportation 40/day; 250/trip",
        "value": 40,
        "unit": "USD/day",
        "requires_preapproval": false,
        "non_reimbursable": false
      },
      {
        "rule_id": 4,
        "category": "ground_transportation",
        "type": "per_trip_cap",
        "scope": "domestic",
        "reference": "Budget Table: Ground Transportation 40/day; 250/trip",
        "value": 250,
        "unit": "USD/trip",
        "requires_preapproval": false,
        "non_reimbursable": false
      },
      {
        "rule_id": 5,
        "category": "airfare",
        "type": "booking_class_restriction",
        "scope": "domestic",
        "reference": "Travel Policy: Economy class mandatory unless long flight",
        "value": "economy (premium economy allowed if flight >8 hours)",
        "unit": "",
        "requires_preapproval": true,
        "non_reimbursable": false
      },
      {
        "rule_id": 6,
        "category": "visa_and_documents",
        "type": "per_trip_cap",
        "scope": "international",
        "reference": "Policy: Visa & Travel Documents reimbursable per-trip",
        "value": 150,
        "unit": "USD/trip",
        "requires_preapproval": false,
        "non_reimbursable": false
      },
      {
        "rule_id": 7,
        "category": "client_entertainment",
        "type": "per_trip_cap",
        "scope": "domestic",
        "reference": "Policy: Client entertainment requires pre-approval; cap 200/trip",
        "value": 200,
        "unit": "USD/trip",
        "requires_preapproval": true,
        "non_reimbursable": false
      },
      {
        "rule_id": 8,
        "category": "mileage",
        "type": "per_trip_cap",
        "scope": "domestic",
        "reference": "Policy: mileage reimbursement; must provide odometer record",
        "value": null,
        "unit": "USD/trip",
        "requires_preapproval": false,
        "non_reimbursable": false
      },
      {
        "rule_id": 9,
        "category": "receipts",
        "type": "receipt_threshold",
        "scope": "domestic",
        "reference": "Expense policy: attach itemized receipts for all expenses >$25",
        "value": 25,
        "unit": "USD",
        "requires_preapproval": false,
        "non_reimbursable": false
      },
      {
        "rule_id": 10,
        "category": "lodging",
        "type": "class_restriction",
        "scope": "domestic",
        "reference": "Policy: luxury hotel not reimbursable",
        "value": "no luxury hotels (mid-range preferred)",
        "unit": "",
        "requires_preapproval": false,
        "non_reimbursable": false
      }
    ]
  },
  "compliance_output_schema": {
    "$defs": {
      "RuleCheck": {
        "properties": {
          "rule_id": {
            "title": "Rule Id",
            "type": "integer"
          },
          "satisfied": {
            "title": "Satisfied",
            "type": "boolean"
          },
          "evidence": {
            "description": "Short reference: category sums, lines, dates, class of service, receipt threshold checks, etc.",
            "title": "Evidence",
            "type": "string"
          },
          "over_by": {
            "anyOf": [
              {
                "type": "number"
              },
              {
                "type": "null"
              }
            ],
            "description": "Amount exceeding the cap, if any.",
            "title": "Over By"
          },
          "severity": {
            "enum": [
              "low",
              "medium",
              "high"
            ],
            "title": "Severity",
            "type": "string"
          },
          "suggested_fix": {
            "title": "Suggested Fix",
            "type": "string"
          }
        },
        "required": [
          "rule_id",
          "satisfied",
          "evidence",
          "over_by",
          "severity",
          "suggested_fix"
        ],
        "title": "RuleCheck",
        "type": "object",
        "additionalProperties": false
      },
      "TotalByCategory": {
        "properties": {
          "category": {
            "title": "Category",
            "type": "string"
          },
          "amount": {
            "title": "Amount",
            "type": "number"
          }
        },
        "required": [
          "category",
          "amount"
        ],
        "title": "TotalByCategory",
        "type": "object",
        "additionalProperties": false
      }
    },
    "properties": {
      "totals_by_category": {
        "description": "Combined totals in USD by category across all documents.",
        "items": {
          "$ref": "#/$defs/TotalByCategory"
        },
        "title": "Totals By Category",
        "type": "array"
      },
      "overall_total_usd": {
        "title": "Overall Total Usd",
        "type": "number"
      },
      "rule_checks": {
        "items": {
          "$ref": "#/$defs/RuleCheck"
        },
        "title": "Rule Checks",
        "type": "array"
      },
      "decision": {
        "enum": [
          "approve",
          "needs_fixes",
          "reject"
        ],
        "title": "Decision",
        "type": "string"
      }
    },
    "required": [
      "totals_by_category",
      "overall_total_usd",
      "rule_checks",
      "decision"
    ],
    "title": "ComplianceCheck",
    "type": "object",
    "additionalProperties": false
  }
}